name: â˜© Publish Codex Scrolls

on:
  push:
    branches:
      - main
      - dev-branch
  workflow_dispatch:

jobs:
  publish:
    runs-on: ubuntu-latest

    steps:
      - name: â¬‡ï¸ Checkout Repository
        uses: actions/checkout@v4
        with:
          fetch-depth: 0

      - name: ğŸ§° Setup Node.js
        uses: actions/setup-node@v4
        with:
          node-version: '20'

      - name: ğŸ“¦ Install Dependencies
        run: npm install

      - name: ğŸ§¾ Generate scrolls.json (Manifest)
        run: node generate-manifest.js

      - name: ğŸ—ºï¸ Generate sitemap.xml
        run: node generate-sitemap.js

      - name: ğŸ” Configure Git
        run: |
          git config user.name "Codex Bot"
          git config user.email "bot@codex-ecclesia.org"

      - name: âœ… Commit and Push Updates
        run: |
          git add scrolls.json sitemap.xml
          git diff --cached --quiet || git commit -m "â˜© Update scrolls.json & sitemap.xml"
          git push

      - name: âœ… Commit and Push Updates
        run: |
          git add scrolls.json sitemap.xml robots.txt
          git diff --cached --quiet || git commit -m "â˜© Update scrolls.json, sitemap.xml, and robots.txt"
          git push
